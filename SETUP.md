# EzChat Setup Instructions

## Quick Start Guide

### 1. Install Dependencies
```bash
npm install
```

### 2. Set Up Clerk Authentication

1. Go to [clerk.com](https://clerk.com) and sign up
2. Create a new application
3. In the Clerk Dashboard:
   - Go to **Configure** → **User & Authentication**
   - Enable **Username** authentication
   - Disable email verification (optional for development)
4. Copy your API keys from **API Keys** section

### 3. Set Up Convex Backend

```bash
npx convex dev
```

This will:
- Prompt you to log in to Convex
- Create a new project (or link existing)
- Generate your deployment URL
- Start the Convex development server

Keep this terminal running!

### 4. Configure Environment Variables

Copy the example file:
```bash
cp .env.local.example .env.local
```

Edit `.env.local` with your values:
```env
# From Convex (generated by `npx convex dev`)
CONVEX_DEPLOYMENT=dev:xxxxx
NEXT_PUBLIC_CONVEX_URL=https://xxxxx.convex.cloud

# From Clerk Dashboard → API Keys
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_xxxxx
CLERK_SECRET_KEY=sk_test_xxxxx

# From Clerk Dashboard → Webhooks (see step 5)
CLERK_WEBHOOK_SECRET=whsec_xxxxx
```

### 5. Configure Clerk Webhook

1. In Clerk Dashboard, go to **Webhooks**
2. Click **Add Endpoint**
3. **Endpoint URL**: `https://your-convex-site.convex.site/clerk`
   - Find your Convex site URL by running: `npx convex dashboard`
   - Or check the Convex dashboard for your deployment URL
4. **Subscribe to events**:
   - `user.created`
   - `user.updated`
   - `user.deleted`
5. Copy the **Signing Secret** and add it to `.env.local` as `CLERK_WEBHOOK_SECRET`

### 6. Create Superuser Accounts (Optional)

After first run, you can manually add superuser accounts via Convex Dashboard:

1. Open Convex Dashboard: `npx convex dashboard`
2. Go to **Data** → **users** table
3. Find your user account
4. Edit and set:
   - `role`: "superuser"
   - `isSuperuser`: true

Create 4 superuser accounts for:
- AI Assistant
- Site Owner (you)
- Future Bot
- Future COO

### 7. Run Development Server

In a new terminal (keep Convex running):
```bash
npm run dev
```

Visit `http://localhost:3000`

## First-Time Usage

1. **Sign Up**: Click "Sign In" and create an account
2. **Claim Username**: Enter an ALL CAPS username (e.g., "JOHN")
3. **Your chatroom is created**: Available at `localhost:3000/JOHN`
4. **Allow camera access**: Required to join chatroom
5. **Share your link**: Others can join your chatroom by visiting your URL

## Development Workflow

### Run both Convex and Next.js
```bash
# Terminal 1
npm run convex:dev

# Terminal 2
npm run dev
```

### View Convex Dashboard
```bash
npx convex dashboard
```

### View Logs
```bash
# Convex logs
npx convex logs

# Next.js logs (in terminal)
```

## Troubleshooting

### "Missing webhook secret" error
- Make sure `CLERK_WEBHOOK_SECRET` is set in `.env.local`
- Restart the Convex dev server after adding it

### Users not syncing from Clerk
1. Check webhook is configured correctly
2. Verify webhook signing secret matches `.env.local`
3. Check Convex logs: `npx convex logs`
4. Test webhook in Clerk Dashboard → Webhooks → Testing

### Camera not working
- Use `localhost` or HTTPS (required for camera access)
- Check browser permissions
- Try different browser

### Can't send messages
- You need "regular" role or higher
- Ask room owner to promote you from guest
- Check Convex logs for errors

## Production Deployment

### Deploy Convex
```bash
npm run convex:deploy
```

### Deploy Next.js (Vercel)
```bash
vercel deploy
```

Or push to GitHub and connect to Vercel.

### Update Environment Variables
1. In Vercel: Settings → Environment Variables
2. Add all variables from `.env.local`
3. Update Clerk webhook URL to production Convex URL

## Testing Roles

### Test as Guest
1. Create account, claim username
2. Visit someone else's chatroom
3. You'll be a guest (can cam, can't chat)

### Test as Regular
1. Room owner right-clicks your name
2. Selects "Make Regular"
3. You can now send messages

### Test as Moderator
1. Must be assigned by room owner
2. Can manage guests and regulars
3. Cannot affect owner or other mods

### Test as Room Owner
1. Visit your own chatroom (`/YOURNAME`)
2. Full moderation controls
3. Can assign mods and regulars

## Next Steps

- [ ] Integrate polar.sh for billing
- [ ] Add GSAP animations to homepage
- [ ] Implement WebRTC peer connections (currently mocked)
- [ ] Add direct messaging for paid tiers
- [ ] Create admin dashboard
- [ ] Add site-wide ban interface

---

For more details, see [README.md](./README.md)
